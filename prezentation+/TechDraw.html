<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>shelf01を作る</title>
  <style>
    body {
      display: flex;
      flex-direction: row;
      height: 100vh;
      margin: 0;
      font-family: sans-serif;
    }
    main {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
    }
    video {
      max-width: 100%;
      max-height: 100%;
    }
    aside {
      width: 180px; /* 幅を最小限に */
      overflow-y: auto;
      border-left: 1px solid #ccc;
      padding: 0.5rem;
      background: #f9f9f9;
      font-size: 0.85rem;
    }
    aside ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    aside li {
      margin: 0.2rem 0;
      cursor: pointer;
      padding: 0.2rem;
      border-radius: 4px;
    }
    aside li.active {
      background: #cce5ff;
    }
  </style>
</head>
<body>
  <main>
    <video id="player" controls>
      <source src="TechDraw.mp4" type="video/mp4">
      <track id="chaptersTrack" kind="chapters" default>
    </video>
  </main>
  <aside>
    <h3>チャプター</h3>
    <ul id="chaptersList"></ul>
  </aside>

  <script type="text/vtt" id="chaptersVTT">
WEBVTT

00:00:00.000 --> 00:00:21.500
これを図面化していきます。

00:00:21.500 --> 00:00:28.330
TechDrawを選択

00:00:28.330 --> 00:00:34.860
テンプレートの用紙を選択

00:00:34.860 --> 00:00:59.410
A4_Landscape_blank.svgを選択

00:00:59.410 --> 00:01:06.150
Body選択後に、2D図面を挿入

00:01:06.150 --> 00:02:06:400
2D図面の向きと大きさをお好みで調整

00:02:06:400 --> 00:03:22.750
寸法や面取りの値を入れる

00:03:22.750 --> 00:03:53.080
断面図を挿入

00:03:53.080 --> 00:04:29.250
キャプションを入れる

00:04:29.250 --> 00:04:40.910
最終調整

00:04:40.910 --> 00:04:48.750
画像出力

00:04:48.750 --> 00:05:08.680
画像確認
  </script>

  <script>
  const video = document.getElementById('player');
  const trackEl = document.getElementById('chaptersTrack');
  const listEl = document.getElementById('chaptersList');
  const vttText = document.getElementById('chaptersVTT').textContent.trim();
  const blob = new Blob([vttText], {type:'text/vtt'});
  trackEl.src = URL.createObjectURL(blob);

  function buildChapters() {
    const track = trackEl.track || video.textTracks[0];
    if (!track || !track.cues || track.cues.length === 0) {
      // cuesがまだ空なら少し待つ
      setTimeout(buildChapters, 200);
      return;
    }
    for (let cue of track.cues) {
      const li = document.createElement('li');
      li.textContent = cue.text;
      li.addEventListener('click', () => {
        video.currentTime = cue.startTime;
        video.play();
      });
      listEl.appendChild(li);
    }
    video.addEventListener('timeupdate', () => {
      for (let i=0; i<listEl.children.length; i++) {
        const li = listEl.children[i];
        const cue = track.cues[i];
        li.classList.toggle('active',
          video.currentTime >= cue.startTime && video.currentTime < cue.endTime
        );
      }
    });
  }

  video.addEventListener('loadedmetadata', buildChapters);
</script>

</body>
</html>
